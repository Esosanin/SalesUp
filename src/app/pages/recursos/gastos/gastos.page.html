<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start" *ngIf="!showSearchbar">
      <ion-menu-button></ion-menu-button>
      <ion-back-button defaultHref="tabs/recursos"></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end" *ngIf="!showSearchbar">
      <ion-button (click)="showSearchbar = true; focus();">
        <ion-icon color="primary" slot="icon-only" name="search"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title *ngIf="!showSearchbar">Gastos</ion-title>
    <ion-searchbar #searchInput *ngIf="showSearchbar" showCancelButton="always" (ionInput)="searchGasto($event)"
      (ionCancel)="showSearchbar=false; searchGasto($event);" (ionClear)="searchGasto($event)" placeholder="Buscar">
    </ion-searchbar>
  </ion-toolbar>
  <ion-toolbar>
    <ion-segment [scrollable]="true" #segment [(ngModel)]="segmentValue" (ionChange)="segmentChange($event)">
      <ion-segment-button *ngFor="let segment of segments" [value]="segment.value">
        <ion-label>{{segment.name}}</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" *ngIf="segment.value==='misSol'">
  <ion-refresher slot="fixed" (ionRefresh)="refresh($event)" pullFactor="0.8" pullMin="60" pullMax="120">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <ion-segment [(ngModel)]="subSegment" color="dark" (ionChange)="refresh(false)">
    <ion-segment-button value="solicitudes">
      <ion-label>Solicitudes</ion-label>
    </ion-segment-button>
    <ion-segment-button value="adeudos">
      <ion-label>Adeudos</ion-label>
    </ion-segment-button>
  </ion-segment>
  <ion-text
    *ngIf="(subSegment === 'solicitudes' && solicitudes.length <=0) || subSegment === 'adeudos' && adeudos.length <= 0">
    <p class="ion-padding">No se encontraron registros.</p>
  </ion-text>
  <ion-row *ngIf="solicitudes.length > 0 && subSegment ==='solicitudes'">
    <ion-col *ngFor="let solicitud of solicitudes.slice(0,limite); let i = index" size="12" size-sm="4">
      <ion-item>
        <ion-label
          [ngClass]="{
          'finalizada': solicitud.estado === 7,
          'pendiente': solicitud.estado === 4 || solicitud.estado === 6,
          'enproceso': solicitud.estado === 1 || solicitud.estado === 2 || solicitud.estado === 3 || solicitud.estado === 5}">
          <h3>#{{solicitud.sol_id}} | {{solicitud.sol_nombre}}</h3>
          <p>Aprobador: {{solicitud.aprobador}}</p>
          <p>Fecha: {{datePipe.transform(solicitud.create_date,'dd/MM/yyyy')}}</p>
        </ion-label>
        <ion-buttons slot="end">
          <!-- <ion-button (click)="detalleMisGastos(i)">
              <ion-icon slot="icon-only" name="information" color="primary"></ion-icon>
            </ion-button> -->
          <ion-button (click)="crearInforme(solicitud.sol_id)" title="Crear informe"
            *ngIf="solicitud.estado === 7 && !solicitud.informe" id="crearInformePopover">
            <ion-icon slot="icon-only" name="add-outline" color="primary"></ion-icon>
          </ion-button>
          <ion-button (click)="verInforme(solicitud.sol_id)" title="Comprobar gastos"
            *ngIf="solicitud.informe && (solicitud.inf_estado === 1 || solicitud.inf_estado === 4 || solicitud.inf_estado === 6)">
            <ion-icon slot="icon-only" name="cash-outline" color="primary"></ion-icon>
          </ion-button>
          <ion-button (click)="verSolicitud(solicitud.sol_id, true)" title="Ver solicitud"
            *ngIf="solicitud.estado === 2 || solicitud.estado === 3 || solicitud.estado === 4 || solicitud.estado === 5 || solicitud.estado === 6 || (solicitud.estado === 7 && !solicitud.informe)">
            <ion-icon slot="icon-only" name="eye-outline" color="primary"></ion-icon>
          </ion-button>
          <ion-button (click)="continuarSolicitud(solicitud.sol_id)" *ngIf="solicitud.estado === 1"
            title="Continuar solicitud">
            <ion-icon slot="icon-only" name="open-outline" color="primary"></ion-icon>
          </ion-button>
          <ion-button (click)="deleteSolicitud(solicitud.sol_id)"
            *ngIf="solicitud.estado === 1 || solicitud.estado === 4 || solicitud.estado === 6"
            title="Eliminar solicitud">
            <ion-icon slot="icon-only" name="trash-outline" color="danger"></ion-icon>
          </ion-button>
          <ion-button (click)="verInforme(solicitud.sol_id)"
            *ngIf="solicitud.estado === 7 && solicitud.informe && (solicitud.inf_estado === 2 || solicitud.inf_estado === 5 || solicitud.inf_estado === 3)"
            title="Ver informe">
            <ion-icon slot="icon-only" name="reader-outline" color="primary"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-col>
  </ion-row>
  <ion-row *ngIf="adeudos.length > 0 && subSegment ==='adeudos'">
    <ion-col *ngFor="let adeudo of adeudos.slice(0,limite); let i = index" size="12" size-sm="4">
      <ion-item>
        <ion-label
          [ngClass]="{enproceso: adeudo.estatus==='Pendiente' || adeudo.estatus==='Enviado', finalizada: adeudo.estatus==='Aprobado', pendiente: adeudo.estatus==='Rechazado'}">
          <h3>{{adeudo.sol_nombre}}</h3>
          <p>Monto adeudo: {{formatoMoneda(adeudo.monto)}}</p>
          <p>Estado: {{adeudo.estatus}}</p>
        </ion-label>
        <ion-buttons slot="end">
          <ion-button (click)="verComprobanteAdeudo(adeudo.id_adeudo)" title="Ver comprobante">
            <ion-icon slot="icon-only" name="eye-outline" color="primary"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-col>
  </ion-row>
  <ion-modal (didDismiss)="showModalAnexo = false" [isOpen]="showModalAnexo" class="modalChico">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="showModalAnexo = false;">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>Comprobante</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
          <ion-row class="ion-justify-content-center" *ngIf="anexo !== null">
            <ion-col size="8" size-sm="4">
              <a [href]="anexosURL + anexo" target="_blank" rel="noopener noreferrer">
                <img [src]="anexosURL + anexo" alt="anexo" width="auto">
              </a>
            </ion-col>
          </ion-row>
        <form [formGroup]="anexoComprobanteForm" (ngSubmit)="enviarComprobanteAdeudo()">
          <ion-row class="ion-justify-content-center">
            <ion-col size="10" size-sm="5">
              <ion-input (ionChange)="anexarComprobanteAdeudo()" #comprobanteAnexo accept="image/jpeg,image/png,image/jpg" formControlName="anexo" type="file"
                class="ion-hide"></ion-input>
              <ion-button *ngIf="anexoComprobanteForm.invalid && anexo === null" expand="full" (click)="anexarComprobante()" color="tertiary" shape="round" class="ion-margin-vertical">
                <ion-icon slot="start" name="document-attach-outline"></ion-icon>
                Anexar comprobante
              </ion-button>
          <img *ngIf="previewComprobanteAdeudo" [src]="anexoComprobante" alt="" width="295" height="330">
            </ion-col>
          </ion-row>
          <ion-row class="ion-justify-content-end">
            <ion-col size="6" size-sm="3">
              <ion-button shape="round" expand="full" color="danger" (click)="eliminarAnexoAdeudo()"
            *ngIf="anexoComprobanteForm.valid">
            <ion-icon slot="start" name="trash-outline"></ion-icon>
            Eliminar
          </ion-button>
            </ion-col>
            <ion-col size="6" size-sm="3">
              <ion-button shape="round" expand="full" color="primary" type="submit"
            *ngIf="anexoComprobanteForm.valid">
            <ion-icon slot="start" name="save-outline"></ion-icon>
            Guardar
          </ion-button>
            </ion-col>
          </ion-row>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-modal (didDismiss)="openAgregarGasto = false" [isOpen]="openAgregarGasto" class="modalChico ion-align-items-end">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="openAgregarGasto = false;">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>{{agregarGastoTitle}}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <form [formGroup]="gastoForm" (ngSubmit)="saveGasto()">
          <ion-row class="ion-justify-content-center">
            <ion-col size="12" size-sm="6">
              <ion-item>
                <ion-icon slot="start" name="layers" color="primary"></ion-icon>
                <ion-label position="stacked">Tipo de gasto</ion-label>
                <ion-select required cancelText="Cancelar" formControlName="tipo_gasto" interface="action-sheet"
                  placeholder="Seleccionar">
                  <ion-select-option *ngFor="let tipo of tipoGasto"
                    [value]="tipo.id_gasto">{{tipo.gasto_name}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="6">
              <ion-item>
                <ion-icon slot="start" name="chatbox" color="primary"></ion-icon>
                <ion-label position="stacked">Concepto del gasto</ion-label>
                <ion-input required type="text" formControlName="descripcion"
                  placeholder="Descripción del gasto"></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="6">
              <ion-item>
                <ion-icon slot="start" name="calculator" color="primary"></ion-icon>
                <ion-label position="stacked">Cantidad</ion-label>
                <ion-input required #cantidad formControlName="cantidad" type="number" placeholder="0"
                  min="0"></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="6">
              <ion-item>
                <ion-icon slot="start" name="calculator" color="primary"></ion-icon>
                <ion-label position="stacked">Precio unitario</ion-label>
                <ion-input required #precio_unitario formControlName="precio_unitario" type="number" placeholder="0"
                  min="0"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-item lines="none">
            <ion-label slot="end" color="primary">
              <h2>Total: {{addGastoTotal}}</h2>
            </ion-label>
          </ion-item>
          <ion-row class="ion-justify-content-end">
            <ion-col size="12" size-sm="4">
              <ion-button [disabled]="gastoForm.invalid" type="submit" expand="full" shape="round">
                <ion-icon slot="start" name="save-outline"></ion-icon>
                Guardar
              </ion-button>
            </ion-col>
          </ion-row>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-modal (didDismiss)="openNuevaSolicitud = false" [isOpen]="openNuevaSolicitud" class="modalNormal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="openNuevaSolicitud = false;">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>{{nuevaSolicitudTitle}}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item lines="none">
          <ion-label class="ion-text-end">
            <ion-button (click)="addGasto()" shape="round" color="primary" fill="solid">
              <ion-icon slot="start" name="add"></ion-icon>
              Agregar gasto
            </ion-button>
          </ion-label>
        </ion-item>
        <ion-list>
          <ion-list-header>
            <ion-label>Gastos solicitados</ion-label>
          </ion-list-header>
          <ion-row class="ion-justify-content-center">
            <ion-col size="12" size-sm="10" *ngFor="let gasto of gastos; let i = index">
              <ion-item>
                <ion-buttons slot="end">
                  <ion-button (click)="editGasto(i)">
                    <ion-icon slot="icon-only" name="create-outline" color="primary"></ion-icon>
                  </ion-button>
                  <ion-button (click)="deleteGasto(gasto.id_gasto)">
                    <ion-icon slot="icon-only" name="trash-outline" color="danger"></ion-icon>
                  </ion-button>
                </ion-buttons>
                <ion-label class="items">
                  <h3>{{gasto.gasto_name}}</h3>
                  <p style="white-space: pre-line;">{{gasto.descripcion}}</p>
                  <p>{{formatoMoneda(gasto.total)}}</p>
                </ion-label>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-list>
        <ion-row class="ion-justify-content-center">
          <ion-col size="10" size-sm="5">
            <ion-button (click)="enviarRevision()" size="medium" shape="round" expand="full" color="success">
              <ion-icon slot="start" name="send-outline"></ion-icon>
              Enviar a aprobación
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-modal (didDismiss)="openDetalleMisSol = false" [isOpen]="openDetalleMisSol" class="modalGrande">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="openDetalleMisSol = false;">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>Detalle de la solicitud</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list>
          <ion-row>
            <ion-col size="12" size-sm="6" *ngFor="let detalle of detalleSolicitud"
              [ngClass]="{'ion-hide': detalle.proyecto === false || detalle.lider === false}">
              <ion-item lines="none">
                <ion-icon slot="start" [name]="detalle.icon + '-outline'" color="primary"></ion-icon>
                <ion-label>
                  <h3 style="white-space:pre-line;">{{detalle.title}}</h3>
                  <p style="white-space:pre-line;">{{detalle.subtitle}}</p>
                </ion-label>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-list>
        <ion-list>
          <ion-list-header>
            <ion-label>Gastos solicitados</ion-label>
          </ion-list-header>
          <ion-row>
            <ion-col size="12" size-sm="6" *ngFor="let gasto of gastos; let i = index;">
              <ion-item>
                <ion-buttons slot="end" *ngIf="sol_estado === 4 || sol_estado === 6">
                  <ion-button (click)="editGasto(i)">
                    <ion-icon slot="icon-only" name="create-outline" color="primary"></ion-icon>
                  </ion-button>
                  <ion-button (click)="deleteGasto(gasto.id_gasto)">
                    <ion-icon slot="icon-only" name="trash-outline" color="danger"></ion-icon>
                  </ion-button>
                </ion-buttons>
                <ion-label class="items">
                  <h3>{{gasto.gasto_name}}</h3>
                  <p>Concepto: {{gasto.descripcion}}</p>
                  <p>Monto: {{formatoMoneda(gasto.total)}}</p>
                </ion-label>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-list>
        <ion-item lines="none">
          <ion-label class="ion-text-end" color="primary">
            <h1>Total: {{formatoMoneda(total)}}</h1>
          </ion-label>
        </ion-item>
        <ion-card class="ion-text-center" [ngClass]="solEstadoColor">
          <ion-card-header>
            <ion-card-title
              [color]="solEstadoColor==='aprobada'?'success':solEstadoColor==='espera'?'medium':'danger'">{{aprobadoRechazado}}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            {{sol_estado === 3 ? comentarioLider : sol_estado === 4 ? comentarioLider : sol_estado === 2 ?
            comentarioLider
            : comentarioFinanzas}}
          </ion-card-content>
        </ion-card>
        <ion-row class="ion-justify-content-center" *ngIf="sol_estado === 4 || sol_estado === 6">
          <ion-col size="12" size-sm="3">
            <ion-button (click)="enviarRevision()" shape="round" expand="full">
              <ion-icon slot="start" name="send-outline"></ion-icon>
              Enviar a revisión
            </ion-button>
          </ion-col>
        </ion-row>
        <ion-row class="ion-justify-content-center" *ngIf="sol_estado === 5 || sol_estado === 7">
          <ion-col size="8" size-sm="2">
            <ion-button (click)="generarPDF()" shape="round" expand="full">
              <ion-icon slot="start" src="./assets/icon/pdf.svg"></ion-icon>
              Generar PDF
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-modal (didDismiss)="openInforme = false; solicitud = false;" [isOpen]="openInforme" class="modalGrande">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="start" *ngIf="solicitud">
            <ion-button (click)="cerrarSolicitud()">
              <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-buttons slot="end">
            <ion-button (click)="openInforme = false;">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>{{informeTitle}}</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-row *ngIf="solicitud">
          <ion-col size="12" size-sm="6" *ngFor="let detalle of detalleSolicitud"
            [ngClass]="{'ion-hide': detalle.proyecto === false || detalle.lider === false}">
            <ion-item lines="none">
              <ion-icon slot="start" [name]="detalle.icon +'-outline'" color="primary"></ion-icon>
              <ion-label>
                <h3 style="white-space:pre-line;">{{detalle.title}}</h3>
                <p style="white-space:pre-line;">{{detalle.subtitle}}</p>
              </ion-label>
            </ion-item>
          </ion-col>
        </ion-row>
        <ion-list *ngIf="solicitud">
          <ion-list-header>
            <ion-label>Gastos solicitados</ion-label>
          </ion-list-header>
          <ion-row>
            <ion-col size="12" size-sm="6" *ngFor="let gasto of gastos; let i = index;">
              <ion-item>
                <ion-buttons slot="end" *ngIf="sol_estado === 4 || sol_estado === 6">
                  <ion-button (click)="editGasto(i)">
                    <ion-icon slot="icon-only" name="create-outline" color="primary"></ion-icon>
                  </ion-button>
                  <ion-button (click)="deleteGasto(gasto.id_gasto)">
                    <ion-icon slot="icon-only" name="trash-outline" color="danger"></ion-icon>
                  </ion-button>
                </ion-buttons>
                <ion-label class="items">
                  <h3>{{gasto.gasto_name}}</h3>
                  <p>Concepto: {{gasto.descripcion}}</p>
                  <p>Monto: {{formatoMoneda(gasto.total)}}</p>
                </ion-label>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-list>
        <ion-card class="ion-text-center" [ngClass]="solEstadoColor" *ngIf="solicitud">
          <ion-card-header>
            <ion-card-title
              [color]="solEstadoColor==='aprobada'?'success':solEstadoColor==='espera'?'medium':'danger'">{{aprobadoRechazado}}</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            {{sol_estado === 3 ? comentarioLider : sol_estado === 4 ? comentarioLider : sol_estado === 2 ?
            comentarioLider
            : comentarioFinanzas}}
          </ion-card-content>
        </ion-card>
        <ion-row class="ion-justify-content-center" *ngIf="solicitud">
          <ion-col size="8" size-sm="2">
            <ion-button (click)="generarPDF()" shape="round" expand="full" size="medium">
              <ion-icon slot="start" src="./assets/icon/pdf.svg"></ion-icon>
              Generar PDF
            </ion-button>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="!solicitud">
          <ion-col size="12" size-sm="6">
            <ion-row
              *ngIf="(informeStatus === 2 && ((excedido === 1 && aprobador === 1) || (excedido !== 1 && finanzas === 1))) || (informeStatus === 5 && finanzas === 1)">
              <ion-col size="12" size-sm="6">
                <ion-item lines="none">
                  <ion-label>
                    <ion-button (click)="registrarGasto()" shape="round" color="danger" expand="full" size="medium">
                      <ion-icon slot="start" name="close-outline"></ion-icon>
                      Rechazar
                    </ion-button>
                  </ion-label>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-sm="6">
                <ion-item lines="none">
                  <ion-label>
                    <ion-button (click)="registrarGasto()" shape="round" color="success" expand="full" size="medium">
                      <ion-icon slot="start" name="checkmark-outline"></ion-icon>
                      Aprobar
                    </ion-button>
                  </ion-label>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row class="ion-justify-content-center" *ngIf="informeStatus === 3 && finanzas === 1">
              <ion-col size="10" size-sm="6">
                <ion-button (click)="imprimir()" shape="round" expand="full">
                  <ion-icon slot="start" name="print-outline"></ion-icon>
                  Imprimir comprobantes
                </ion-button>
              </ion-col>
              <ion-col size="8" size-sm="4">
                <ion-button (click)="generarPDF()" shape="round" expand="full">
                  <ion-icon slot="start" src="./assets/icon/pdf.svg"></ion-icon>
                  Generar PDF
                </ion-button>
              </ion-col>
            </ion-row>
            <ion-row class="ion-justify-content-end"
              *ngIf="(informeStatus === 1 || informeStatus === 4 || informeStatus === 6) && solicitante === 1">
              <ion-col size="12" size-sm="4">
                <ion-button (click)="registrarGasto()" shape="round" expand="full" size="small">
                  <ion-icon slot="start" name="add"></ion-icon>
                  Registrar gasto
                </ion-button>
              </ion-col>
            </ion-row>
            <ion-list *ngIf="gastosInforme.length > 0">
              <ion-radio-group (ionChange)="gastoSelected($event)" [value]="gastosInforme[0].gasd_id">
                <ion-list-header>
                  <ion-label>Gastos</ion-label>
                </ion-list-header>
                <ion-item lines="none" *ngFor="let gasto of gastosInforme; let i = index;">
                  <ion-label>
                    <h3 style="white-space:pre-line;">{{gasto.gasto_name}}</h3>
                    <p>Monto: {{formatoMoneda(gasto.total)}}</p>
                    <p>Fecha: {{datePipe.transform(gasto.fecha_transaccion,'dd/MM/yyyy')}}</p>
                  </ion-label>
                  <ion-radio [value]="gasto.gasd_id" slot="start"></ion-radio>
                </ion-item>
              </ion-radio-group>
            </ion-list>
            <ion-row>
              <ion-col size="12" size-sm="6">
                <ion-item lines="none">
                  <ion-label style="font-weight: bold;">Total solicitado: {{totalSolicitado}}</ion-label>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-sm="6">
                <ion-item lines="none">
                  <ion-label style="font-weight: bold;">Total comprobado: {{totalComprobado}}</ion-label>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row *ngIf="(informeStatus === 1 || informeStatus === 4) && solicitante === 1">
              <ion-col size="12" size-sm="6">
                <ion-item lines="none">
                  <ion-label>
                    <ion-button (click)="guardarContinuar()" shape="round" color="warning" expand="full">
                      <ion-icon slot="start" name="save-outline"></ion-icon>
                      Guardar y continuar luego
                    </ion-button>
                  </ion-label>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-sm="5">
                <ion-item lines="none">
                  <ion-label>
                    <ion-button (click)="terminarInforme()" shape="round" color="success" expand="full">
                      <ion-icon slot="start" name="send-outline"></ion-icon>
                      Terminar informe
                    </ion-button>
                  </ion-label>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-card
              *ngIf="(informeStatus === 3 || informeStatus === 4 || informeStatus === 5 || informeStatus === 6) && (solicitante === 1 || finanzas === 1)"
              class="ion-text-center" style="border: 3px solid #2dd36f;">
              <ion-card-header>
                <ion-card-title
                  [color]="aprobadoRechazado === 'Aprobada' ? 'success' : 'danger'">{{aprobadoRechazado}}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                {{comentarioLider}}
              </ion-card-content>
            </ion-card>
            <ion-row class="ion-justify-content-center">
              <ion-col size="8" size-sm="4">
                <ion-button (click)="verSolicitud(sol_id,false)" shape="round" expand="full">
                  <ion-icon slot="start" name="document-outline"></ion-icon>
                  Ver solicitud
                </ion-button>
              </ion-col>
            </ion-row>
          </ion-col>
          <ion-col size="12" size-sm="6">
            <ion-segment #segmentInforme value="detalles">
              <ion-segment-button value="detalles">
                <ion-label>Detalles</ion-label>
              </ion-segment-button>
              <ion-segment-button value="comprobantes">
                <ion-label>Comprobantes</ion-label>
              </ion-segment-button>
            </ion-segment>
            <ion-list *ngIf="segmentInforme.value==='detalles'">
              <ion-item *ngIf="gastosInforme.length <= 0" lines="none">
                <ion-label>Sin comprobantes registrados.</ion-label>
              </ion-item>
              <ion-row *ngIf="gastosInforme.length > 0">
                <ion-col size="12" size-sm="6" *ngFor="let detalle of infDetalles">
                  <ion-item lines="none">
                    <ion-icon slot="start" [name]="detalle.icon + '-outline'" color="primary"></ion-icon>
                    <ion-label>
                      <h3>{{detalle.title}}</h3>
                      <p style="white-space:pre-line">
                        {{detalle.title==='Moneda'?(detalle.subtitle===1?'MXN':detalle.subtitle===2?'USD':detalle.subtitle===3?'EUR':'SOL'):detalle.subtitle}}
                      </p>
                    </ion-label>
                  </ion-item>
                </ion-col>
              </ion-row>
            </ion-list>
            <div *ngIf="segmentInforme.value==='comprobantes'" style="height: 95%;">
              <ion-item *ngIf="gastosInforme.length <= 0" lines="none">
                <ion-label>Sin comprobantes registrados.</ion-label>
              </ion-item>
              <ion-item lines="none" *ngIf="comprobantes[1].url!==undefined">
                <ion-label>
                  <ion-button (click)="downloadXML(comprobantes[1].xml)">
                    <ion-icon slot="start" name="download-outline"></ion-icon>
                    Descargar XML
                  </ion-button>
                </ion-label>
              </ion-item>
              <iframe *ngIf="comprobantes[0].url!==undefined" [src]="comprobantes[0].url" width="100%"
                height="500px"></iframe>
            </div>
          </ion-col>
        </ion-row>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-modal (didDismiss)="openRegistroGasto = false" [isOpen]="openRegistroGasto" class="modalChico"
    [backdropDismiss]="false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-buttons slot="end">
            <ion-button (click)="closeRegistroGasto()">
              <ion-icon slot="icon-only" name="close-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title>Comprobar gasto</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-row>
          <ion-col size="12" size-sm="6">
            <ion-item fill="solid">
              <ion-label position="stacked">Tipo de comprobante</ion-label>
              <ion-select (ionChange)="tipoComprobanteChange($event)" #tipoComprobante placeholder="Seleccionar"
                interface="action-sheet" cancelText="Cancelar">
                <ion-select-option value="factura">Factura</ion-select-option>
                <ion-select-option value="recibo">Recibo (ticket)</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          <ion-col class="ion-text-center" size="12" size-sm="6"
            *ngIf="tipoComprobante.value === 'factura' && !xmlAnexado">
            <ion-button [disabled]="archivoXML !==''" (click)="anexarXML()" shape="round" color="tertiary">
              <ion-icon slot="start" src="assets/icon/xml.svg"></ion-icon>
              Anexar XML
            </ion-button>
          </ion-col>
          <ion-col size="12" size-sm="6" *ngIf="tipoComprobante.value==='factura' && archivoPDF!==''">
            <ion-item lines="none">
              <ion-icon slot="start" src="assets/icon/pdf.svg" color="primary"></ion-icon>
              <ion-label>
                <h3>Anexo</h3>
                <p>{{archivoPDF}}</p>
              </ion-label>
              <ion-buttons slot="end">
                <ion-button (click)="deleteAnexo('pdf')" title="Eliminar anexo" fill="clear" shape="round">
                  <ion-icon slot="icon-only" name="close" color="danger"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-item>
          </ion-col>
          <ion-col size="12" size-sm="6" *ngIf="tipoComprobante.value==='recibo' && archivoIMG!==''">
            <ion-item lines="none">
              <ion-icon slot="start" name="image" color="primary"></ion-icon>
              <ion-label>
                <h3>Anexo</h3>
                <p>{{archivoIMG}}</p>
              </ion-label>
              <ion-buttons slot="end">
                <ion-button (click)="deleteAnexo('img')" title="Eliminar anexo" fill="clear" shape="round">
                  <ion-icon slot="icon-only" name="close" color="danger"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-item>
          </ion-col>
          <ion-col class="ion-text-center" size="12" size-sm="6"
            *ngIf="tipoComprobante.value === 'factura' && archivoPDF ==='' && xmlAnexado">
            <ion-button (click)="anexarPDF()" shape="round" color="tertiary">
              <ion-icon slot="start" src="assets/icon/pdf.svg"></ion-icon>
              Anexar PDF
            </ion-button>
          </ion-col>
          <ion-col class="ion-text-center" size="12" size-sm="6"
            *ngIf="tipoComprobante.value === 'recibo' && archivoIMG ===''">
            <ion-button (click)="anexarIMG()" shape="round" color="tertiary">
              <ion-icon slot="start" name="image-outline"></ion-icon>
              Anexar ticket
            </ion-button>
          </ion-col>
        </ion-row>
        <form [formGroup]="informeForm" (ngSubmit)="informeSubmit(tipoComprobante.value)">
          <ion-row *ngIf="showReciboForm">
            <ion-col size="12" size-sm="6">
              <ion-item>
                <ion-label position="stacked">Tipo de gasto</ion-label>
                <ion-select formControlName="tipo_gasto" placeholder="Seleccionar" interface="action-sheet" required
                  cancelText="Cancelar">
                  <ion-select-option *ngFor="let gasto of tipoGasto"
                    [value]="gasto.id_gasto">{{gasto.gasto_name}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="6">
              <ion-item>
                <ion-label position="stacked">Establecimiento</ion-label>
                <ion-input type="text" formControlName="razon_social" placeholder="Razón social" required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-item>
                <ion-label position="stacked">Ciudad de compra</ion-label>
                <ion-input type="text" formControlName="cd_compra" placeholder="Ej. Hermosillo, Sonora"
                  required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-item>
                <ion-label position="stacked">RFC</ion-label>
                <ion-input type="text" formControlName="rfc" placeholder="XXXX000000XXX" required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-item>
                <ion-label position="stacked">Fecha de transacción</ion-label>
                <ion-input type="date" formControlName="fecha_transaccion" required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-item>
                <ion-label position="stacked">Subtotal</ion-label>
                <ion-input #subtotal type="number" formControlName="subtotal" min="0" placeholder="0"
                  required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-item>
                <ion-label position="stacked">IVA</ion-label>
                <ion-input #iva type="number" formControlName="iva" min="0" placeholder="0" required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-item>
                <ion-label position="stacked">Moneda</ion-label>
                <ion-select formControlName="moneda" placeholder="Seleccionar" interface="action-sheet" required
                  cancelText="Cancelar">
                  <ion-select-option [value]="1">MXN</ion-select-option>
                  <ion-select-option [value]="2">USD</ion-select-option>
                  <ion-select-option [value]="3">EUR</ion-select-option>
                  <ion-select-option [value]="4">SOL</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="8">
              <ion-item>
                <ion-label position="stacked">Comentarios</ion-label>
                <ion-input type="text" formControlName="comentarios" placeholder="Ej. Examen médico"
                  required></ion-input>
              </ion-item>
            </ion-col>
            <ion-col size="12" size-sm="4" class="ion-text-center">
              <ion-text color="primary">
                <h4>Total: {{comprobarGastoTotal}}</h4>
              </ion-text>
            </ion-col>
          </ion-row>
          <ion-row class="ion-justify-content-end" *ngIf="showReciboForm">
            <ion-col size="12" size-sm="4" *ngIf="tipoComprobante.value==='factura'">
              <ion-button (click)="cancelarXML(false)" shape="round" expand="full" color="danger" size="medium">
                <ion-icon slot="start" name="close"></ion-icon>
                Cancelar
              </ion-button>
            </ion-col>
            <ion-col size="12" size-sm="4">
              <ion-button type="submit" shape="round" expand="full" [disabled]="!informeForm.valid" size="medium">
                <ion-icon slot="start" name="save-outline"></ion-icon>
                Guardar
              </ion-button>
            </ion-col>
          </ion-row>
          <ion-input #fileXML type="file" class="ion-hide" (ionChange)="fileXMLChange()" accept="text/xml"></ion-input>
          <ion-input #filePDF type="file" class="ion-hide" (ionChange)="filePDFChange()"
            accept="application/pdf"></ion-input>
          <ion-input #fileIMG type="file" class="ion-hide" (ionChange)="fileIMGChange()"
            accept="image/png, image/jpeg, image/jpg"></ion-input>
          <ion-list *ngIf="tipoComprobante.value === 'factura' && archivoXML!==''">
            <ion-list-header>
              <ion-label>Archivos anexados</ion-label>
            </ion-list-header>
            <ion-row *ngIf="archivoXML !== ''">
              <ion-col size="12" size-sm="8">
                <ion-item lines="none">
                  <ion-buttons slot="end">
                    <ion-button (click)="subirDatosXML()" title="Subir datos">
                      <ion-icon slot="icon-only" name="cloud-upload-outline" color="primary"></ion-icon>
                    </ion-button>
                    <ion-button (click)="cancelXML()" title="Eliminar anexo">
                      <ion-icon slot="icon-only" name="close" color="danger"></ion-icon>
                    </ion-button>
                  </ion-buttons>
                  <ion-icon slot="start" src="assets/icon/xml.svg" color="primary"></ion-icon>
                  <ion-label>
                    <h3>Factura</h3>
                    <p>{{archivoXML}}</p>
                  </ion-label>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-list>
        </form>
        <ion-text color="primary" class="ion-text-center" *ngIf="tipoComprobante.value === undefined">
          <p class="ion-padding-top">Seleccione el tipo de comprobante para continuar.</p>
        </ion-text>
        <ion-text color="primary" class="ion-text-center"
          *ngIf="tipoComprobante.value === 'factura' && archivoXML!==''">
          <p>Haga click en el botón <ion-icon name="cloud-upload-outline" size="medium"></ion-icon> para continuar, o
            elimine el anexo para seleccionar otro.</p>
        </ion-text>
        <ion-text color="primary" class="ion-text-center"
          *ngIf="tipoComprobante.value==='factura' && !xmlAnexado && archivoXML===''">
          <p class="ion-padding-top">Haga click en el botón "Anexar XML" para seleccionar su factura.</p>
        </ion-text>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-infinite-scroll [disabled]="solicitudes.length <= limite" position="bottom" (ionInfinite)="addItems($event)">
    <ion-infinite-scroll-content loadingSpinner="dots" loadingText="Cargando...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
<ion-content class="ion-padding" *ngIf="segment.value==='solAprob'"></ion-content>
<ion-content class="ion-padding" *ngIf="segment.value==='infAprob'"></ion-content>
<ion-content class="ion-padding" *ngIf="segment.value==='polGastos'"></ion-content>
